<!-- ...existing HTML code... -->
<script>
  // --- SPA Navigation ---
  function showPage(pageId) {
    document.querySelectorAll('.page-section').forEach(section => section.style.display = 'none');
    document.getElementById(pageId).style.display = 'block';
    window.scrollTo(0,0);
  }
  window.onload = function() {
    showPage('home');
    document.querySelectorAll('.nav-link').forEach(link => {
      link.onclick = function(e) {
        e.preventDefault();
        showPage(this.dataset.page);
      }
    });
  };

  // --- Main App Logic ---
  document.addEventListener('DOMContentLoaded', function() {
    // Quiz logic
    const quizForm = document.getElementById('nyonya-quiz');
    if (quizForm) {
      quizForm.onsubmit = function(e) {
        e.preventDefault();
        const q1 = quizForm.q1.value, q2 = quizForm.q2.value, q3 = quizForm.q3.value;
        let title = '', desc = '';
        if (q1 === 'sweet' && q2 === 'kueh') {
          title = "You’re a Pandan Latte Dreamer!";
          desc = "You love sweet, fragrant flavors and heritage treats. Try our Pandan Oat Milk Latte with a side of Nyonya Kueh!";
        } else if (q1 === 'bold' && q3 === 'black') {
          title = "You’re a Pandan Espresso Lover!";
          desc = "You like it strong and pure. Our bold Pandan Espresso is your perfect match!";
        } else if (q3 === 'oat') {
          title = "You’re a Modern Nyonya!";
          desc = "You enjoy creamy oat milk and new twists on tradition. Try our Pandan Oat Milk Latte!";
        } else if (q2 === 'toast') {
          title = "You’re a Classic Kopitiam Fan!";
          desc = "Kaya Toast and coffee are your comfort zone. Enjoy our Nyonya Pandan Coffee with toast!";
        } else {
          title = "You’re a Heritage Explorer!";
          desc = "You love to try new things. Explore our full menu for your next favorite!";
        }
        document.getElementById('brew-title').textContent = title;
        document.getElementById('brew-desc').textContent = desc;
        document.getElementById('quiz-result').classList.remove('hidden');
        quizForm.classList.add('hidden');
      };
      const shareBtn = document.getElementById('share-btn');
      if (shareBtn) {
        shareBtn.onclick = function() {
          const title = document.getElementById('brew-title').textContent;
          const url = encodeURIComponent(window.location.href);
          const text = encodeURIComponent("I got: " + title + " on the Nyonya Pandan Coffee Quiz! #NyonyaBrew");
          window.open('https://twitter.com/intent/tweet?text=' + text + '&url=' + url, '_blank');
        };
      }
    }

    // Drink Customizer Logic
    const form = document.getElementById('drink-customizer');
    if (form) {
      const fill = document.getElementById('drink-fill');
      const milk = document.getElementById('milk-surface');
      const addonDot = document.getElementById('addon-dot');
      const summary = document.getElementById('customizer-summary');
      const addonIcons = document.getElementById('addon-icons');
      const saveBtn = document.getElementById('save-blend');
      const saveMsg = document.getElementById('save-msg');

      function addonSVG(name) {
        if (name === 'Gula Melaka Drizzle')
          return '<span title="Gula Melaka"><svg width="24" height="24"><circle cx="12" cy="12" r="8" fill="#8d5524"/></svg></span>';
        if (name === 'Pandan Jelly')
          return '<span title="Pandan Jelly"><svg width="24" height="24"><rect x="4" y="8" width="16" height="8" rx="3" fill="#43a047"/></svg></span>';
        if (name === 'Espresso Shot')
          return '<span title="Espresso Shot"><svg width="24" height="24"><ellipse cx="12" cy="12" rx="8" ry="4" fill="#3e2723"/></svg></span>';
        return '';
      }

      function updatePreview() {
        const size = form.size.value, milkType = form.milk.value, sugar = form.sugar.value;
        const addons = Array.from(form.querySelectorAll('input[name="addon"]:checked')).map(cb => cb.value);
        fill.setAttribute('fill', milkType === 'Oat' ? '#ffe082' : '#a5d6a7');
        let milkCy, fillY, fillH;
        if (size === 'Small') { milkCy = 100; fillY = milkCy; fillH = 10; }
        else if (size === 'Medium') { milkCy = 90; fillY = milkCy; fillH = 20; }
        else { milkCy = 80; fillY = milkCy; fillH = 30; }
        milk.setAttribute('cy', milkCy);
        fill.setAttribute('y', fillY);
        fill.setAttribute('height', fillH);
        milk.setAttribute('fill', milkType === 'Oat' ? '#fffde7' : '#fff');
        milk.setAttribute('opacity', milkType === 'black' ? '0' : '0.7');
        addonDot.setAttribute('opacity', addons.length ? '1' : '0');
        addonIcons.innerHTML = addons.map(addonSVG).join('');
        summary.textContent = size + " cup, " + milkType + " milk, " + sugar + (addons.length ? ", Add-ons: " + addons.join(", ") : "");
      }
      form.onchange = updatePreview;
      updatePreview();

      if (saveBtn) {
        saveBtn.onclick = function() {
          saveMsg.classList.remove('hidden');
          setTimeout(() => saveMsg.classList.add('hidden'), 2500);
        };
      }
    }
  });
</script>
<!-- ...existing HTML code... -->